<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAKETY API Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; }
        redoc { 
            font-family: 'Roboto', sans-serif;
        }
        .redoc-wrap {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div id="redoc-container"></div>
    <script src="https://cdn.jsdelivr.net/npm/redoc@2.1.3/bundles/redoc.standalone.js"></script>
    <script>
        const apiSpec = {
            "openapi": "3.0.3",
            "info": {
                "title": "PAKETY - Grocery Delivery Platform API",
                "description": "Comprehensive API documentation for PAKETY, a robust multilingual grocery delivery platform for the Iraqi market. This system provides complete order management, driver coordination, and real-time notifications through WebSocket connections.",
                "version": "2.1.0",
                "contact": {
                    "name": "PAKETY Development Team",
                    "url": "https://pakety.delivery"
                },
                "license": {
                    "name": "Private License",
                    "url": "https://pakety.delivery/license"
                }
            },
            "servers": [
                {
                    "url": "https://pakety.delivery",
                    "description": "Production Server"
                },
                {
                    "url": "http://localhost:5000",
                    "description": "Development Server"
                }
            ],
            "tags": [
                {
                    "name": "Authentication",
                    "description": "User and driver authentication endpoints"
                },
                {
                    "name": "Categories",
                    "description": "Product category management"
                },
                {
                    "name": "Products",
                    "description": "Product catalog and inventory management"
                },
                {
                    "name": "Cart",
                    "description": "Shopping cart operations"
                },
                {
                    "name": "Orders",
                    "description": "Order management and tracking"
                },
                {
                    "name": "Drivers",
                    "description": "Driver management and operations"
                },
                {
                    "name": "Users",
                    "description": "User profile and address management"
                },
                {
                    "name": "Wallet",
                    "description": "Digital wallet and payment operations"
                },
                {
                    "name": "Notifications",
                    "description": "Push notifications and messaging"
                },
                {
                    "name": "Mobile",
                    "description": "Mobile app specific endpoints"
                },
                {
                    "name": "WebSocket",
                    "description": "Real-time WebSocket connections"
                }
            ],
            "paths": {
                "/api/auth/signup": {
                    "post": {
                        "tags": ["Authentication"],
                        "summary": "User registration",
                        "description": "Register a new user account with session-based authentication",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "email": {
                                                "type": "string",
                                                "format": "email",
                                                "example": "mxmoddmd@gmail.com"
                                            },
                                            "password": {
                                                "type": "string",
                                                "minLength": 6,
                                                "example": "password123"
                                            },
                                            "fullName": {
                                                "type": "string",
                                                "example": "محمد أحمد"
                                            },
                                            "phone": {
                                                "type": "string",
                                                "pattern": "^07[0-9]{9}$",
                                                "example": "07512345678"
                                            }
                                        },
                                        "required": ["email", "password", "phone"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "User registered successfully",
                                "headers": {
                                    "Set-Cookie": {
                                        "description": "Session cookie for authentication",
                                        "schema": {
                                            "type": "string",
                                            "example": "connect.sid=s%3A...; Path=/; HttpOnly"
                                        }
                                    }
                                },
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "user": {
                                                    "$ref": "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "400": {
                                "description": "Invalid registration data"
                            },
                            "409": {
                                "description": "Email or phone already exists"
                            }
                        }
                    }
                },
                "/api/auth/signin": {
                    "post": {
                        "tags": ["Authentication"],
                        "summary": "User login",
                        "description": "Login with email and password, creates session-based authentication",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "email": {
                                                "type": "string",
                                                "format": "email",
                                                "example": "mxmoddmd@gmail.com"
                                            },
                                            "password": {
                                                "type": "string",
                                                "example": "password123"
                                            }
                                        },
                                        "required": ["email", "password"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Login successful",
                                "headers": {
                                    "Set-Cookie": {
                                        "description": "Session cookie for authentication",
                                        "schema": {
                                            "type": "string",
                                            "example": "connect.sid=s%3A...; Path=/; HttpOnly"
                                        }
                                    }
                                },
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "user": {
                                                    "$ref": "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Invalid credentials"
                            }
                        }
                    }
                },
                "/api/auth/signout": {
                    "post": {
                        "tags": ["Authentication"],
                        "summary": "User logout",
                        "description": "Logout and destroy session",
                        "security": [{"SessionAuth": []}],
                        "responses": {
                            "200": {
                                "description": "Logout successful",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "message": {
                                                    "type": "string",
                                                    "example": "Signed out successfully"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/auth/session": {
                    "get": {
                        "tags": ["Authentication"],
                        "summary": "Check session status",
                        "description": "Verify current session and get user information",
                        "security": [{"SessionAuth": []}],
                        "responses": {
                            "200": {
                                "description": "Session valid",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "user": {
                                                    "$ref": "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Not authenticated or session expired"
                            }
                        }
                    }
                },
                "/api/whatsapp/send-otp": {
                    "post": {
                        "tags": ["Authentication"],
                        "summary": "Send WhatsApp OTP",
                        "description": "Send OTP verification code via WhatsApp using WasenderAPI",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "phoneNumber": {
                                                "type": "string",
                                                "pattern": "^07[0-9]{9}$",
                                                "example": "07512345678"
                                            },
                                            "fullName": {
                                                "type": "string",
                                                "example": "أحمد محمد"
                                            }
                                        },
                                        "required": ["phoneNumber", "fullName"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "OTP sent successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean",
                                                    "example": true
                                                },
                                                "message": {
                                                    "type": "string",
                                                    "example": "تم إرسال رمز التحقق إلى تطبيق الواتساب"
                                                },
                                                "delivered": {
                                                    "type": "string",
                                                    "enum": ["wasender", "fallback"],
                                                    "example": "wasender"
                                                },
                                                "otp": {
                                                    "type": "string",
                                                    "description": "Only returned in fallback mode for development",
                                                    "example": "1234"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "500": {
                                "description": "Failed to send OTP"
                            }
                        }
                    }
                },
                "/api/whatsapp/verify-otp": {
                    "post": {
                        "tags": ["Authentication"],
                        "summary": "Verify WhatsApp OTP",
                        "description": "Verify the OTP code received via WhatsApp",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "phoneNumber": {
                                                "type": "string",
                                                "pattern": "^07[0-9]{9}$",
                                                "example": "07512345678"
                                            },
                                            "otp": {
                                                "type": "string",
                                                "pattern": "^[0-9]{4}$",
                                                "example": "1234"
                                            }
                                        },
                                        "required": ["phoneNumber", "otp"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "OTP verified successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "message": {
                                                    "type": "string",
                                                    "example": "تم التحقق بنجاح"
                                                },
                                                "valid": {
                                                    "type": "boolean",
                                                    "example": true
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "400": {
                                "description": "Invalid or expired OTP"
                            }
                        }
                    }
                },
                "/api/auth/addresses": {
                    "post": {
                        "tags": ["Users"],
                        "summary": "Create user address",
                        "description": "Add a new address for the authenticated user",
                        "security": [{"SessionAuth": []}],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "$ref": "#/components/schemas/CreateUserAddress"
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Address created successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/UserAddress"
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Authentication required"
                            }
                        }
                    }
                },
                "/api/auth/addresses/{userId}": {
                    "get": {
                        "tags": ["Users"],
                        "summary": "Get user addresses",
                        "description": "Retrieve all addresses for a specific user (must be authenticated as that user)",
                        "security": [{"SessionAuth": []}],
                        "parameters": [
                            {
                                "name": "userId",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "User ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "User addresses",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/UserAddress"
                                            }
                                        }
                                    }
                                }
                            },
                            "403": {
                                "description": "Access denied - can only access own addresses"
                            }
                        }
                    }
                },
                "/api/users": {
                    "get": {
                        "tags": ["Users"],
                        "summary": "Get all users (Admin)",
                        "description": "Retrieve all registered users (admin endpoint)",
                        "security": [{"BearerAuth": []}],
                        "responses": {
                            "200": {
                                "description": "List of all users",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/User"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/users/{id}": {
                    "delete": {
                        "tags": ["Users"],
                        "summary": "Delete user (Admin)",
                        "description": "Delete a user account (admin endpoint)",
                        "security": [{"BearerAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "User ID to delete"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "User deleted successfully"
                            },
                            "400": {
                                "description": "Invalid user ID"
                            }
                        }
                    }
                },
                "/api/version": {
                    "get": {
                        "tags": ["System"],
                        "summary": "Get API version",
                        "description": "Returns current API version and timestamp for cache busting",
                        "responses": {
                            "200": {
                                "description": "Version information",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "version": { "type": "string", "example": "2.1.0" },
                                                "timestamp": { "type": "number", "example": 1754572424600 }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/categories": {
                    "get": {
                        "tags": ["Categories"],
                        "summary": "Get all categories",
                        "description": "Retrieve all available product categories",
                        "responses": {
                            "200": {
                                "description": "List of categories",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/Category"
                                            }
                                        }
                                    }
                                }
                            },
                            "500": {
                                "description": "Failed to fetch categories"
                            }
                        }
                    }
                },
                "/api/categories/{id}/select": {
                    "patch": {
                        "tags": ["Categories"],
                        "summary": "Select a category",
                        "description": "Mark a category as selected",
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Category ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Category updated successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Category"
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Category not found"
                            }
                        }
                    }
                },
                "/api/products": {
                    "get": {
                        "tags": ["Products"],
                        "summary": "Get all products",
                        "description": "Retrieve all products or filter by category",
                        "parameters": [
                            {
                                "name": "categoryId",
                                "in": "query",
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Filter by category ID"
                            },
                            {
                                "name": "search",
                                "in": "query",
                                "schema": {
                                    "type": "string"
                                },
                                "description": "Search products by name"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "List of products",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/Product"
                                            }
                                        }
                                    }
                                }
                            },
                            "500": {
                                "description": "Failed to fetch products"
                            }
                        }
                    },
                    "post": {
                        "tags": ["Products"],
                        "summary": "Create a new product",
                        "description": "Add a new product to the catalog",
                        "security": [{"BearerAuth": []}],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "$ref": "#/components/schemas/CreateProduct"
                                    }
                                }
                            }
                        },
                        "responses": {
                            "201": {
                                "description": "Product created successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Product"
                                        }
                                    }
                                }
                            },
                            "400": {
                                "description": "Invalid product data"
                            }
                        }
                    }
                },
                "/api/products/{id}": {
                    "get": {
                        "tags": ["Products"],
                        "summary": "Get product by ID",
                        "description": "Retrieve a specific product by its ID",
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Product ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Product details",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Product"
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Product not found"
                            }
                        }
                    },
                    "put": {
                        "tags": ["Products"],
                        "summary": "Update product",
                        "description": "Update an existing product",
                        "security": [{"BearerAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Product ID"
                            }
                        ],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "$ref": "#/components/schemas/UpdateProduct"
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Product updated successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Product"
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Product not found"
                            }
                        }
                    }
                },
                "/api/cart": {
                    "get": {
                        "tags": ["Cart"],
                        "summary": "Get cart items",
                        "description": "Retrieve all items in the shopping cart",
                        "security": [{"SessionAuth": []}],
                        "responses": {
                            "200": {
                                "description": "List of cart items",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/CartItem"
                                            }
                                        }
                                    }
                                }
                            },
                            "500": {
                                "description": "Failed to fetch cart items"
                            }
                        }
                    },
                    "post": {
                        "tags": ["Cart"],
                        "summary": "Add item to cart",
                        "description": "Add a product to the shopping cart",
                        "security": [{"SessionAuth": []}],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "$ref": "#/components/schemas/AddToCart"
                                    }
                                }
                            }
                        },
                        "responses": {
                            "201": {
                                "description": "Item added to cart",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/CartItem"
                                        }
                                    }
                                }
                            },
                            "400": {
                                "description": "Invalid cart item data"
                            }
                        }
                    },
                    "delete": {
                        "tags": ["Cart"],
                        "summary": "Clear cart",
                        "description": "Remove all items from the shopping cart",
                        "security": [{"SessionAuth": []}],
                        "responses": {
                            "200": {
                                "description": "Cart cleared successfully"
                            }
                        }
                    }
                },
                "/api/cart/{id}": {
                    "patch": {
                        "tags": ["Cart"],
                        "summary": "Update cart item quantity",
                        "description": "Update the quantity of a specific cart item",
                        "security": [{"SessionAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Cart item ID"
                            }
                        ],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "quantity": {
                                                "type": "integer",
                                                "minimum": 1
                                            }
                                        },
                                        "required": ["quantity"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Cart item updated",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/CartItem"
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Cart item not found"
                            }
                        }
                    },
                    "delete": {
                        "tags": ["Cart"],
                        "summary": "Remove item from cart",
                        "description": "Remove a specific item from the shopping cart",
                        "security": [{"SessionAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Cart item ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Item removed from cart"
                            },
                            "404": {
                                "description": "Cart item not found"
                            }
                        }
                    }
                },
                "/api/orders": {
                    "get": {
                        "tags": ["Orders"],
                        "summary": "Get user orders",
                        "description": "Retrieve all orders for the authenticated user",
                        "security": [{"SessionAuth": []}],
                        "responses": {
                            "200": {
                                "description": "List of orders",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/Order"
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Authentication required"
                            }
                        }
                    },
                    "post": {
                        "tags": ["Orders"],
                        "summary": "Create new order",
                        "description": "Place a new order from cart items",
                        "security": [{"SessionAuth": []}],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "$ref": "#/components/schemas/CreateOrder"
                                    }
                                }
                            }
                        },
                        "responses": {
                            "201": {
                                "description": "Order created successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Order"
                                        }
                                    }
                                }
                            },
                            "400": {
                                "description": "Invalid order data"
                            },
                            "401": {
                                "description": "Authentication required"
                            }
                        }
                    }
                },
                "/api/orders/{id}": {
                    "get": {
                        "tags": ["Orders"],
                        "summary": "Get order by ID",
                        "description": "Retrieve a specific order by its ID",
                        "security": [{"SessionAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Order ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Order details",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Order"
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Order not found"
                            }
                        }
                    }
                },
                "/api/orders/{id}/status": {
                    "patch": {
                        "tags": ["Orders"],
                        "summary": "Update order status",
                        "description": "Update the status of an existing order (admin/driver only)",
                        "security": [{"BearerAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Order ID"
                            }
                        ],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "status": {
                                                "type": "string",
                                                "enum": ["pending", "confirmed", "preparing", "out_for_delivery", "delivered", "cancelled"]
                                            }
                                        },
                                        "required": ["status"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Order status updated",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/Order"
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Order not found"
                            }
                        }
                    }
                },
                "/api/drivers/auth/login": {
                    "post": {
                        "tags": ["Drivers"],
                        "summary": "Driver authentication",
                        "description": "Authenticate driver and generate JWT token",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "email": {
                                                "type": "string",
                                                "format": "email",
                                                "example": "test@pakety.com"
                                            },
                                            "password": {
                                                "type": "string",
                                                "example": "driver123"
                                            }
                                        },
                                        "required": ["email", "password"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Authentication successful",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "token": {
                                                    "type": "string",
                                                    "description": "JWT authentication token"
                                                },
                                                "driver": {
                                                    "$ref": "#/components/schemas/Driver"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Invalid credentials"
                            }
                        }
                    }
                },
                "/api/drivers/profile": {
                    "get": {
                        "tags": ["Drivers"],
                        "summary": "Get driver profile",
                        "description": "Retrieve authenticated driver's profile information",
                        "security": [{"BearerAuth": []}],
                        "responses": {
                            "200": {
                                "description": "Driver profile",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "driver": {
                                                    "$ref": "#/components/schemas/Driver"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Authentication required"
                            }
                        }
                    }
                },
                "/api/drivers/stats": {
                    "get": {
                        "tags": ["Drivers"],
                        "summary": "Get driver statistics",
                        "description": "Retrieve performance statistics for authenticated driver",
                        "security": [{"BearerAuth": []}],
                        "responses": {
                            "200": {
                                "description": "Driver statistics",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "stats": {
                                                    "type": "object",
                                                    "properties": {
                                                        "todayDeliveries": {
                                                            "type": "integer"
                                                        },
                                                        "totalDeliveries": {
                                                            "type": "integer"
                                                        },
                                                        "totalEarnings": {
                                                            "type": "number"
                                                        },
                                                        "averageRating": {
                                                            "type": "number"
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Authentication required"
                            }
                        }
                    }
                },
                "/api/drivers/orders": {
                    "get": {
                        "tags": ["Drivers"],
                        "summary": "Get driver orders",
                        "description": "Retrieve orders assigned to the authenticated driver",
                        "security": [{"BearerAuth": []}],
                        "parameters": [
                            {
                                "name": "status",
                                "in": "query",
                                "schema": {
                                    "type": "string",
                                    "enum": ["assigned", "confirmed", "out_for_delivery", "delivered"]
                                },
                                "description": "Filter by order status"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Driver orders",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "orders": {
                                                    "type": "array",
                                                    "items": {
                                                        "$ref": "#/components/schemas/Order"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/drivers/orders/{id}/accept": {
                    "post": {
                        "tags": ["Drivers"],
                        "summary": "Accept order",
                        "description": "Accept an assigned order for delivery",
                        "security": [{"BearerAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Order ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Order accepted",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "message": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "404": {
                                "description": "Order not found"
                            }
                        }
                    }
                },
                "/api/drivers/orders/{id}/decline": {
                    "post": {
                        "tags": ["Drivers"],
                        "summary": "Decline order",
                        "description": "Decline an assigned order",
                        "security": [{"BearerAuth": []}],
                        "parameters": [
                            {
                                "name": "id",
                                "in": "path",
                                "required": true,
                                "schema": {
                                    "type": "integer"
                                },
                                "description": "Order ID"
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Order declined",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "message": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/mobile/auth/login": {
                    "post": {
                        "tags": ["Mobile"],
                        "summary": "Mobile app authentication",
                        "description": "Authenticate user for mobile app and generate JWT token",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "email": {
                                                "type": "string",
                                                "format": "email"
                                            },
                                            "password": {
                                                "type": "string"
                                            }
                                        },
                                        "required": ["email", "password"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Authentication successful",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "token": {
                                                    "type": "string"
                                                },
                                                "user": {
                                                    "$ref": "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "401": {
                                "description": "Invalid credentials"
                            }
                        }
                    }
                },
                "/api/mobile/auth/register": {
                    "post": {
                        "tags": ["Mobile"],
                        "summary": "Mobile user registration",
                        "description": "Register a new user account for mobile app",
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "email": {
                                                "type": "string",
                                                "format": "email"
                                            },
                                            "password": {
                                                "type": "string",
                                                "minLength": 6
                                            },
                                            "fullName": {
                                                "type": "string"
                                            },
                                            "phone": {
                                                "type": "string",
                                                "pattern": "^07[0-9]{9}$"
                                            }
                                        },
                                        "required": ["email", "password", "fullName", "phone"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "201": {
                                "description": "User registered successfully",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "token": {
                                                    "type": "string"
                                                },
                                                "user": {
                                                    "$ref": "#/components/schemas/User"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "400": {
                                "description": "Invalid registration data"
                            }
                        }
                    }
                },
                "/api/wallet/balance": {
                    "get": {
                        "tags": ["Wallet"],
                        "summary": "Get wallet balance",
                        "description": "Retrieve current wallet balance for authenticated user",
                        "security": [{"SessionAuth": []}],
                        "responses": {
                            "200": {
                                "description": "Wallet balance",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "balance": {
                                                    "type": "number",
                                                    "description": "Current wallet balance in IQD"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/wallet/topup": {
                    "post": {
                        "tags": ["Wallet"],
                        "summary": "Top up wallet",
                        "description": "Add funds to user wallet using Zaincash payment gateway",
                        "security": [{"SessionAuth": []}],
                        "requestBody": {
                            "required": true,
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "type": "object",
                                        "properties": {
                                            "amount": {
                                                "type": "integer",
                                                "enum": [5000, 10000, 15000, 25000, 50000, 75000, 100000],
                                                "description": "Top-up amount in IQD"
                                            }
                                        },
                                        "required": ["amount"]
                                    }
                                }
                            }
                        },
                        "responses": {
                            "200": {
                                "description": "Payment URL generated",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "type": "object",
                                            "properties": {
                                                "success": {
                                                    "type": "boolean"
                                                },
                                                "paymentUrl": {
                                                    "type": "string",
                                                    "format": "uri"
                                                },
                                                "transactionId": {
                                                    "type": "string"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/ws": {
                    "get": {
                        "tags": ["WebSocket"],
                        "summary": "WebSocket Connection",
                        "description": "Establish WebSocket connection for real-time updates",
                        "parameters": [
                            {
                                "name": "Sec-WebSocket-Protocol",
                                "in": "header",
                                "schema": {
                                    "type": "string"
                                },
                                "description": "WebSocket subprotocol"
                            }
                        ],
                        "responses": {
                            "101": {
                                "description": "WebSocket connection established"
                            },
                            "400": {
                                "description": "Invalid WebSocket request"
                            }
                        }
                    }
                }
            },
            "components": {
                "securitySchemes": {
                    "BearerAuth": {
                        "type": "http",
                        "scheme": "bearer",
                        "bearerFormat": "JWT",
                        "description": "JWT token for driver authentication"
                    },
                    "SessionAuth": {
                        "type": "apiKey",
                        "in": "cookie",
                        "name": "connect.sid",
                        "description": "Session-based authentication for web users"
                    }
                },
                "schemas": {
                    "Category": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "example": 2
                            },
                            "name": {
                                "type": "string",
                                "example": "Vegetables"
                            },
                            "icon": {
                                "type": "string",
                                "example": "Leaf"
                            },
                            "isSelected": {
                                "type": "boolean",
                                "example": true
                            },
                            "displayOrder": {
                                "type": "integer",
                                "example": 1
                            }
                        }
                    },
                    "Product": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer",
                                "example": 80
                            },
                            "name": {
                                "type": "string",
                                "example": "خيار"
                            },
                            "description": {
                                "type": "string",
                                "example": "خيار طازج"
                            },
                            "price": {
                                "type": "number",
                                "example": 1000
                            },
                            "categoryId": {
                                "type": "integer",
                                "example": 2
                            },
                            "imageUrl": {
                                "type": "string",
                                "format": "uri",
                                "example": "data:image/jpeg;base64,..."
                            },
                            "isAvailable": {
                                "type": "boolean",
                                "example": true
                            },
                            "displayOrder": {
                                "type": "integer",
                                "example": 1
                            }
                        }
                    },
                    "CreateProduct": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string"
                            },
                            "description": {
                                "type": "string"
                            },
                            "price": {
                                "type": "number"
                            },
                            "categoryId": {
                                "type": "integer"
                            },
                            "imageUrl": {
                                "type": "string",
                                "format": "uri"
                            }
                        },
                        "required": ["name", "price", "categoryId"]
                    },
                    "UpdateProduct": {
                        "type": "object",
                        "properties": {
                            "name": {
                                "type": "string"
                            },
                            "description": {
                                "type": "string"
                            },
                            "price": {
                                "type": "number"
                            },
                            "isAvailable": {
                                "type": "boolean"
                            },
                            "displayOrder": {
                                "type": "integer"
                            }
                        }
                    },
                    "CartItem": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer"
                            },
                            "productId": {
                                "type": "integer"
                            },
                            "productName": {
                                "type": "string"
                            },
                            "quantity": {
                                "type": "integer"
                            },
                            "price": {
                                "type": "number"
                            },
                            "total": {
                                "type": "string",
                                "description": "Formatted total price"
                            }
                        }
                    },
                    "AddToCart": {
                        "type": "object",
                        "properties": {
                            "productId": {
                                "type": "integer"
                            },
                            "quantity": {
                                "type": "integer",
                                "minimum": 1
                            }
                        },
                        "required": ["productId", "quantity"]
                    },
                    "Order": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer"
                            },
                            "userId": {
                                "type": "integer"
                            },
                            "customerName": {
                                "type": "string"
                            },
                            "customerPhone": {
                                "type": "string"
                            },
                            "customerAddress": {
                                "type": "string"
                            },
                            "totalAmount": {
                                "type": "string",
                                "description": "Formatted total amount"
                            },
                            "status": {
                                "type": "string",
                                "enum": ["pending", "confirmed", "preparing", "out_for_delivery", "delivered", "cancelled"]
                            },
                            "items": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "id": {
                                            "type": "integer"
                                        },
                                        "name": {
                                            "type": "string"
                                        },
                                        "quantity": {
                                            "type": "integer"
                                        },
                                        "price": {
                                            "type": "number"
                                        },
                                        "total": {
                                            "type": "string"
                                        }
                                    }
                                }
                            },
                            "address": {
                                "$ref": "#/components/schemas/UserAddress"
                            },
                            "createdAt": {
                                "type": "string",
                                "format": "date-time"
                            },
                            "driverId": {
                                "type": "integer",
                                "nullable": true
                            }
                        }
                    },
                    "CreateOrder": {
                        "type": "object",
                        "properties": {
                            "addressId": {
                                "type": "string",
                                "format": "uuid"
                            },
                            "paymentMethod": {
                                "type": "string",
                                "enum": ["wallet"]
                            },
                            "notes": {
                                "type": "string"
                            }
                        },
                        "required": ["addressId", "paymentMethod"]
                    },
                    "User": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer"
                            },
                            "email": {
                                "type": "string",
                                "format": "email"
                            },
                            "fullName": {
                                "type": "string"
                            },
                            "phone": {
                                "type": "string"
                            },
                            "walletBalance": {
                                "type": "number"
                            },
                            "isActive": {
                                "type": "boolean"
                            },
                            "createdAt": {
                                "type": "string",
                                "format": "date-time"
                            }
                        }
                    },
                    "Driver": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "integer"
                            },
                            "fullName": {
                                "type": "string"
                            },
                            "email": {
                                "type": "string",
                                "format": "email"
                            },
                            "phone": {
                                "type": "string"
                            },
                            "vehicleType": {
                                "type": "string"
                            },
                            "licenseNumber": {
                                "type": "string"
                            },
                            "isActive": {
                                "type": "boolean"
                            },
                            "isAvailable": {
                                "type": "boolean"
                            },
                            "rating": {
                                "type": "number",
                                "minimum": 0,
                                "maximum": 5
                            }
                        }
                    },
                    "UserAddress": {
                        "type": "object",
                        "properties": {
                            "id": {
                                "type": "string",
                                "format": "uuid"
                            },
                            "userId": {
                                "type": "integer"
                            },
                            "governorate": {
                                "type": "string"
                            },
                            "district": {
                                "type": "string"
                            },
                            "street": {
                                "type": "string"
                            },
                            "buildingNumber": {
                                "type": "string"
                            },
                            "floorNumber": {
                                "type": "string",
                                "nullable": true
                            },
                            "nearestLandmark": {
                                "type": "string",
                                "nullable": true
                            },
                            "isDefault": {
                                "type": "boolean"
                            }
                        }
                    },
                    "CreateUserAddress": {
                        "type": "object",
                        "properties": {
                            "governorate": {
                                "type": "string",
                                "example": "بغداد"
                            },
                            "district": {
                                "type": "string",
                                "example": "الكرادة"
                            },
                            "street": {
                                "type": "string",
                                "example": "شارع الأطباء"
                            },
                            "buildingNumber": {
                                "type": "string",
                                "example": "15"
                            },
                            "floorNumber": {
                                "type": "string",
                                "nullable": true,
                                "example": "3"
                            },
                            "nearestLandmark": {
                                "type": "string",
                                "nullable": true,
                                "example": "بجانب مستشفى الكرادة"
                            },
                            "isDefault": {
                                "type": "boolean",
                                "example": true
                            }
                        },
                        "required": ["governorate", "district", "street", "buildingNumber"]
                    }
                }
            }
        };

        // WebSocket Documentation Section
        const websocketDocumentation = `
        <div style="margin-top: 2rem; padding: 1rem; border-left: 4px solid #667eea; background: #f8f9ff;">
            <h2>🔄 WebSocket Real-Time Connections</h2>
            
            <h3>Connection Endpoint</h3>
            <code>ws://localhost:5000/ws</code> (Development)<br>
            <code>wss://pakety.delivery/ws</code> (Production)
            
            <h3>Client Registration</h3>
            <p>After establishing WebSocket connection, clients must register:</p>
            <pre><code>{
  "type": "DRIVER_REGISTER",
  "driverId": 2,
  "token": "jwt_token_here"
}</code></pre>
            
            <h3>Server Messages</h3>
            
            <h4>🎯 New Order Notification</h4>
            <p>Sent to drivers when a new order is assigned:</p>
            <pre><code>{
  "type": "NEW_ORDER",
  "orderId": 123,
  "order": {
    "id": 123,
    "customerName": "أحمد محمد",
    "customerPhone": "07512345678",
    "customerAddress": "بغداد - الكرادة",
    "totalAmount": "4,500",
    "items": [
      {
        "id": 1,
        "name": "خيار",
        "quantity": 2,
        "price": 1000,
        "total": "2,000"
      }
    ],
    "address": {
      "governorate": "بغداد",
      "district": "الكرادة",
      "street": "شارع الأطباء",
      "buildingNumber": "15"
    },
    "status": "pending"
  }
}</code></pre>

            <h4>✅ Registration Success</h4>
            <pre><code>{
  "type": "REGISTRATION_SUCCESS",
  "message": "Driver registered successfully",
  "driverId": 2
}</code></pre>

            <h4>📊 Order Status Update</h4>
            <pre><code>{
  "type": "ORDER_STATUS_UPDATE",
  "orderId": 123,
  "status": "confirmed",
  "message": "Order confirmed by driver"
}</code></pre>

            <h3>Client Messages</h3>
            
            <h4>📝 Driver Registration</h4>
            <pre><code>{
  "type": "DRIVER_REGISTER",
  "driverId": 2,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>

            <h4>✅ Order Acceptance</h4>
            <pre><code>{
  "type": "ORDER_ACCEPT",
  "orderId": 123,
  "driverId": 2
}</code></pre>

            <h4>❌ Order Decline</h4>
            <pre><code>{
  "type": "ORDER_DECLINE",
  "orderId": 123,
  "driverId": 2,
  "reason": "Too far from current location"
}</code></pre>

            <h3>🔔 React Native WebView Integration</h3>
            <p>For drivers using React Native WebView, the system automatically sends structured notification data:</p>
            <pre><code>{
  "type": "NEW_ORDER_NOTIFICATION",
  "payload": {
    "orderId": 123,
    "customerName": "أحمد محمد",
    "customerPhone": "07512345678",
    "totalAmount": "4,500",
    "address": "بغداد - الكرادة",
    "items": [...],
    "timestamp": 1754572424600
  }
}</code></pre>
            
            <h3>🎵 Test Notification</h3>
            <p>Test notification data for development:</p>
            <pre><code>{
  "type": "TEST_NOTIFICATION",
  "payload": {
    "orderId": 999,
    "customerName": "اختبار العميل",
    "customerPhone": "07512345678",
    "totalAmount": "4,500",
    "address": "بغداد - الكرادة",
    "items": [{"id": 1, "name": "خيار", "quantity": 2, "price": 1000, "total": "2,000"}],
    "timestamp": 1754572424600
  }
}</code></pre>

            <h3>Error Handling</h3>
            <ul>
                <li><strong>Authentication Failed:</strong> <code>{"type": "ERROR", "message": "Invalid token"}</code></li>
                <li><strong>Registration Failed:</strong> <code>{"type": "ERROR", "message": "Driver not found"}</code></li>
                <li><strong>Invalid Message:</strong> <code>{"type": "ERROR", "message": "Invalid message format"}</code></li>
            </ul>

            <h3>Connection Management</h3>
            <ul>
                <li><strong>Heartbeat:</strong> Send ping every 30 seconds to maintain connection</li>
                <li><strong>Reconnection:</strong> Automatically reconnect on connection loss</li>
                <li><strong>Multiple Connections:</strong> Only latest connection per driver is maintained</li>
            </ul>
        </div>`;

        // Add download functionality
        function downloadApiSpec() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(apiSpec, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "pakety-api-spec.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function downloadHtmlDoc() {
            const htmlContent = document.documentElement.outerHTML;
            const dataStr = "data:text/html;charset=utf-8," + encodeURIComponent(htmlContent);
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "pakety-api-documentation.html");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // Initialize ReDoc with the specification
        Redoc.init(apiSpec, {
            scrollYOffset: 0,
            hideDownloadButton: false,
            theme: {
                colors: {
                    primary: {
                        main: '#667eea'
                    }
                },
                typography: {
                    fontSize: '14px',
                    lineHeight: '1.5em',
                    code: {
                        fontSize: '13px',
                        fontWeight: '600'
                    },
                    headings: {
                        fontFamily: 'Montserrat, sans-serif',
                        fontWeight: '400'
                    }
                },
                sidebar: {
                    backgroundColor: '#fafafa',
                    width: '260px'
                }
            }
        }, document.getElementById('redoc-container'));

        // Add WebSocket documentation and download buttons after ReDoc loads
        setTimeout(() => {
            const container = document.getElementById('redoc-container');
            if (container) {
                // Add download buttons at the top
                const downloadSection = document.createElement('div');
                downloadSection.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    background: rgba(255, 255, 255, 0.95);
                    padding: 15px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    border: 1px solid #e0e0e0;
                `;
                downloadSection.innerHTML = `
                    <h4 style="margin: 0 0 10px 0; color: #333; font-size: 14px;">📥 Download Documentation</h4>
                    <button onclick="downloadApiSpec()" style="
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        margin-right: 8px;
                        font-size: 12px;
                    ">📄 API Spec (JSON)</button>
                    <button onclick="downloadHtmlDoc()" style="
                        background: #764ba2;
                        color: white;
                        border: none;
                        padding: 8px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                    ">🌐 Full HTML Doc</button>
                `;
                document.body.appendChild(downloadSection);

                // Add WebSocket documentation
                const websocketDiv = document.createElement('div');
                websocketDiv.innerHTML = websocketDocumentation;
                container.appendChild(websocketDiv);
            }
        }, 2000);

        // Make download functions globally available
        window.downloadApiSpec = downloadApiSpec;
        window.downloadHtmlDoc = downloadHtmlDoc;
    </script>
</body>
</html>